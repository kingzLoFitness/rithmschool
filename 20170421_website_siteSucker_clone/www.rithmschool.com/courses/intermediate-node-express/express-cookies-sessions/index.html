<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" >

  <meta property="og:image" content="https://www.rithmschool.com/assets/logos/300logo-e647a12a86a37452242b8a21b69d9d1dc4062424c1aba75e17ca49ba66787120.jpg"/>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Learn intermediate Node.js and Express.js including password hashing with bcrypt, using cookies and sessions for authentication, OAuth with passport.js, building and securing JSON APIs and much more">
  <meta name="author" content="Rithm School">


  <title>Free Intermediate Node and Express Course | Rithm School</title>



  <link rel="stylesheet" media="all" href="../../../assets/application-d7dcbdaf43dd221b077a8cf82d4ae2e314969993450100a73fd94aa9c90caf80.css" />

  <!-- Add a stylesheet tag for the name of the action -->
  <link rel="stylesheet" media="screen" href="../../../assets/main-311b580d4f39aec53c868044c9c4ddd3dcb9f6b785075ced94beae423f2fe997.css" />
  <link rel="stylesheet" media="screen" href="../../../assets/online_courses-73b12655e06c0656e106350abb90762bd63ab97cd8134948e3ed89f65216b009.css" />

  <script src="../../../assets/application-cc8be59eb7a71132791fe5ed500b55b1df74021b49c9df6547756bc21c564bf2.js"></script>
  <script src="../../../assets/modernizr-43ece90ce3662a6bd3b00d7acdddd63c4a965f96d0b7e2b9738988f559971b3f.js"></script>

  <link rel="shortcut icon" type="image/x-icon" href="../../../assets/favicon-eb41ae8905bdd2b439d03b1628aaa345c177848bb8e6c36ea8c5a56cf03ef757.ico" />
  <meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="zA3TWMyMdtDtwHVTEz2sZ1ZM8lvDWAKHxGEslvrn55IyozNLkZ1IsOilvgPIXCGFckpoZeFjZyECEgMPAB1pNw==" />

  <!-- Google Analytics -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-81714915-1', 'auto');
    ga('send', 'pageview');

  </script>
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

  <!-- start Mixpanel -->

  <!-- start Mixpanel --><script type="text/javascript">(function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
mixpanel.init("5080e5eebdaa906ad44bebec9a917acb");</script>


<!-- end Mixpanel --><!-- end Mixpanel -->

</head>
<body>
<a id="banner-alert" target="_blank" href="https://part-time.rithmschool.com">
  <div class="container">
    <p type="button" class="close" >&times;</p>
    Our next Part-Time JavaScript Course starts in June. Save $200 if you register before May 10! <u>Click here for details.</u>
  </div>
</a><div class="container">
  <nav id="mainNav" class="navbar navbar-default navbar-custom ">
      <div class="container">
          <!-- Brand and toggle get grouped for better mobile display -->
          <div class="navbar-header page-scroll">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                  <span class="sr-only">Toggle navigation</span><i class="fa fa-2x fa-bars"></i>
              </button>
              <a style="padding:0;" class="navbar-brand page-scroll" href="../../../index.html">
                  <img class="logo" height="58" alt="rithm school company logo" title="Rithm School Logo" src="../../../assets/logos/rithm-school-company-logo-eaabae929e57627848ee756658b028718af7d06d7e7534af22f899dfadfa8aa7.png" />
</a>          </div>

          <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
              <ul class="nav navbar-nav navbar-right" id="mixpanelNav">
                  <li class="dropdown">
                      <a href="javascript:void(0)">
                        Learn Full Time&nbsp;<span class="caret"></span>
</a>                      <ul class="dropdown-menu dropdown-menu-left">
                        <li><a id="#details-tuition" href="../../../program/index.html">Details &amp; Tuition</a>
                        <li><a id="#curriculum" href="../../../curriculum/index.html">Curriculum</a></li>
                        <li><a id="#outcomes" href="../../../outcomes/index.html">Job Support</a></li>
                        <li><a id="#faq" href="../../../faq/index.html">FAQ</a></li>
                      </ul>
                  </li>
                  <li>
                    <a target="_blank" id="#workshops" href="http://www.eventbrite.com/o/rithm-school-11279356650">Coding Workshops</a>
                  </li>
                  <li>
                    <a id="#online-courses" href="../../index.html">Free Online Courses</a>
                  </li>
                  <li>
                    <a id="#partnerships" href="../../../partnerships/index.html">Partnerships</a>
                  </li>
                  <li class="dropdown">
                      <a href="javascript:void(0)">
                        About&nbsp;<span class="caret"></span>
</a>                      <ul class="bottom-dropdown dropdown-menu dropdown-menu-left">
                        <li>
                          <a id="#blog" href="../../../blog/index.html">Blog</a>
                        </li>
                        <li>
                            <a id="#team" href="../../../team/index.html">Our Team</a>
                        </li>
                      </ul>
                  </li>
                  <li>
                      <a class="apply-now" id="#apply" href="../../../apply/index.html">Apply Now</a>
                  </li>
              </ul>
          </div>
          <!-- /.navbar-collapse -->
      </div>
      <!-- /.container-fluid -->
  </nav>

    
<!-- Facebook Pixel Code -->
<script>
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
document,'script','https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '214663358944902');
fbq('track', 'PageView');
</script>
<noscript><img height="1" width="1" style="display:none"
src="https://www.facebook.com/tr?id=214663358944902&ev=PageView&noscript=1"
/></noscript>
<!-- DO NOT MODIFY -->
<!-- End Facebook Pixel Code -->


<h1 class="begin-text heading" >{&nbsp;Cookies and Sessions in Express.&nbsp;}</h1>

<div data-locked-chapter="false" data-unit="1" id="course-content">
  <h3>Objectives:</h3>

<p>By the end of this chapter, you should be able to:</p>

<ul>
<li>Compare and contrast <code>cookies</code> and <code>sessions</code></li>
<li>Read and write cookies using <code>cookie-parser</code></li>
<li>Compare and contrast the <code>cookie-session</code> and <code>express-session</code> modules</li>
</ul>

<h3>Cookies / Sessions</h3>

<p>Now that we are able to successfully store passwords in the database and check whether a user has entered the correct password, we now need a way to <em>remember</em> when a user has logged in! Since the web is stateless, we need some way of remembering across multiple requests that a user has successfully authenticated. To do that we will need to learn about some more persistance tools like cookies and sessions. Here&#39;s some vocabulary:</p>

<p><strong>cookies</strong> - cookies are small pieces of information that we can send from a server to the browser to enable persistence in the browser. Cookies are set using the <code>Set-Cookie</code> response header from the server, and are sent to the server using the <code>Cookie</code> header. We can set and read cookies using <code>req.cookies</code> which is provided by the <code>cookie-parser</code> module (<code>npm install --save cookie-parser</code>).</p>

<p><strong>session</strong> - in order to store data on the server, we make use of something called the <code>session</code>. The session is an object that persists during requests from the client and can be accessed anywhere in the request-response cycle. The session will be different for each user (so if we store information like a <code>userId</code> in the session, it will not be overwritten when other users log in). There are different modules used for storing sessions; two common ones are:</p>

<ul>
<li><code>express-session</code> - stores a session in memory. If the server goes down, the user must log in again.</li>
<li><code>cookie-session</code> - stores a session in memory and sets a cookie in the browser in case the session is destroyed (the cookie will restore the session if it exists and has not expired)</li>
</ul>

<p>Since it is a better user experience to not have to re-log in when the server goes down, we will be using <code>cookie-session</code> for future examples.</p>

<h3>Log in / Log out</h3>

<p>Now that we have a conceptual idea of how to store information across multiple requests using the session (server-side storage), let&#39;s see how we can use the <code>cookie-session</code> module to do that. When we install and use the <code>cookie-session</code> module, we gain access to an object called <code>session</code>, which is part of the <code>req</code> object.</p>
<div class="CodeRay">
  <div class="code"><pre><span class="keyword">var</span> session = require(<span class="string"><span class="delimiter">&quot;</span><span class="content">cookie-session</span><span class="delimiter">&quot;</span></span>);

app.use(session({
    <span class="key">secret</span>: <span class="string"><span class="delimiter">'</span><span class="content">what does this do?</span><span class="delimiter">'</span></span>; <span class="comment">// great question! We will come back to that, but we need it for now!</span>
}))

<span class="comment">// make sure we head to this route</span>
app.get(<span class="string"><span class="delimiter">'</span><span class="content">/</span><span class="delimiter">'</span></span>, <span class="keyword">function</span>(req, res, next){
    req.session.username = <span class="string"><span class="delimiter">'</span><span class="content">Elie</span><span class="delimiter">'</span></span>;
})

app.get(<span class="string"><span class="delimiter">'</span><span class="content">/person</span><span class="delimiter">'</span></span>, <span class="keyword">function</span>(req, res, next){
    res.send(req.session.username); <span class="comment">// it persists!</span>
})
</pre></div>
</div>

<p>Here&#39;s how we can use the session to remember when a user is authenticated. When they successfully authenticate, we will place a very small piece of information in the session. Then, on future requests, we&#39;ll check the session for that information. If it&#39;s there, we can be sure the user is logged in. Similarly, when a user logs out, we will remove the information from the session to mark them as &quot;logged out&quot;. Let&#39;s see what that looks like:</p>
<div class="CodeRay">
  <div class="code"><pre>app.post(<span class="string"><span class="delimiter">'</span><span class="content">/login</span><span class="delimiter">'</span></span>, <span class="keyword">function</span>(req, res, next){
    <span class="comment">// find a user in the db</span>
    db.User.find(req.body.username).then(<span class="keyword">function</span>(foundUser){
        <span class="comment">// use our comparePassword from the user model in the last section</span>
        foundUser.comparePassword(req.body.password, <span class="keyword">function</span>(match){
            <span class="keyword">if</span>(match){
                <span class="comment">// if the user is successfully authenticated</span>
                req.session.user_id = foundUser.id;
            }
        });
    });
});
</pre></div>
</div>

<h3>Secret Keys and dotenv</h3>

<p>So what is this &quot;secret&quot; that we need when we use the <code>cookie-session</code> module? The secret key is a string that is used to encrypt and decrypt the cookie that is being sent to the browser with information from the session. Since we do not want users getting access to the information on the cookie, it&#39;s essential that we encrypt it. At the same time, we do not want people getting access to this secret key, so we need to hide that as well!</p>

<p>Since we have now created quite a few variables that we do not want exposed (like our secret key), we need a way to hide them. Fortunately there is a wonderful module called <code>dotenv</code> to help us. You can read more about it <a target="_blank" href="https://github.com/motdotla/dotenv">here</a>. We first need to install the module <code>npm install --save dotenv</code> and then create a <code>.env</code> file (<code>touch .env</code>). We can now place our environment variables in this file.</p>
<div class="CodeRay">
  <div class="code"><pre>SECRET_KEY=shhhhh
</pre></div>
</div>

<p>Now in our app.js we can load this file using</p>
<div class="CodeRay">
  <div class="code"><pre>require(<span class="string"><span class="delimiter">'</span><span class="content">dotenv</span><span class="delimiter">'</span></span>).load();

<span class="keyword">var</span> secret = process.env.SECRET_KEY;
</pre></div>
</div>

<p>Finally <strong>MAKE SURE</strong> you add <code>.env</code> to your <code>.gitignore</code> with <code>echo .env &gt;&gt; .gitignore</code> so that you do not check in your <code>.env</code> file with Git.</p>

<h3>Ensuring authentication on each request</h3>

<p>Now how can we make sure that users are logged in during each request? We need some middleware, which will intercept a request, check if there is some necessary information in the session (which we place when a user logs in), and either redirect the user back to a log in page, or allow the user to continue with their request. Let&#39;s examine how to implement this in the next section!</p>

<h3>Sample App</h3>

<p>You can find a sample app with bcrypt, cookies, and sessions <a target="_blank" href="https://github.com/rithmschool/node_curriculum_examples/tree/master/cookies_sessions">here</a>.</p>

</div>

<p>
    When you're ready, move on to <a id="next-link" href="../authentication-with-express/index.html">Authentication with Express</a>

</p>

<p class="text-center">
    <a class="apply-now" href="../authentication-with-express/index.html">Continue</a>
</p>
<script src="../../../assets/online_course_chapter-7184317fdfc1eadd48d978323e8253c1efbfd066fe264614c17f90cb37de011c.js"></script>

</div>
<!-- Chatra {literal} -->
<script>
    ChatraID = 'B32ypJxDbLRq5RhQ2';
    ChatraGroupID = 'eXDapncP5vKAcBDr5';
    (function(d, w, c) {
        var n = d.getElementsByTagName('script')[0],
            s = d.createElement('script');
        w[c] = w[c] || function() {
            (w[c].q = w[c].q || []).push(arguments);
        };
        s.async = true;
        s.src = (d.location.protocol === 'https:' ? 'https:': 'http:')
            + '//call.chatra.io/chatra.js';
        n.parentNode.insertBefore(s, n);
    })(document, window, 'Chatra');
</script>
<!-- /Chatra {/literal} -->
<script>
window.ChatraSetup = {
    colors: {
        buttonText: '#ffffff', // chat button text color
        buttonBg: '#F86161'    // chat button background color
    }
};

// // REMOVED when parallax was added
// We only want to delay the chat on the homepage
// so the animation has time to load.
// if (window.location.pathname === '/') {
//   Chatra("hide");
//   setTimeout(function() {
//     Chatra("show");
//   }, 2600);
// }
</script>
<footer>
  <div class="container">
    <div class="row">
        <div class="col-md-3 col-sm-4 text-center">
            <a style="padding:0;" class="footer-logo" href="../../../index.html">
              <img class="logo" height="58" alt="rithm school company logo" title="Rithm School Logo" src="../../../assets/logos/rithm-school-company-logo-eaabae929e57627848ee756658b028718af7d06d7e7534af22f899dfadfa8aa7.png" />
</a>            <span><a class="text-muted faq-url" href="../../../cdn-cgi/l/email-protection/index.html#95fcfbf3fad5e7fce1fdf8e6f6fdfafaf9bbf6faf8"><span class="__cf_email__" data-cfemail="0861666e67487a617c60657b6b60676764266b6765">[email&#160;protected]</span><script data-cfhash='f9e31' type="text/javascript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script></a></span>
        </div>
        <div class="col-md-6 col-sm-8">
          <div class="text-center email_signup_heading">
            <p class="lead">Interested in meetups, courses and free content?</p>
              <button name="button" type="submit" class="btn" id="mailing-list">Join mailing list</button>
          </div>
          <p class="lead text-center thank_you"></p>
        </div>
        <div class="col-md-3 col-sm-4 text-center">
          <ul class="list-inline social-buttons">
              <li><a target="_blank" href="https://www.twitter.com/rithmschool"><i class="fa fa-twitter"></i></a>
              </li>
              <li><a target="_blank" href="https://www.facebook.com/rithmschool"><i class="fa fa-facebook"></i></a>
              </li>
              <li><a target="_blank" href="https://www.linkedin.com/company/rithm-school"><i class="fa fa-linkedin"></i></a>
              </li>
          </ul>
        </div>
    </div>
    <hr>
    <div class="row">
        <div class="col-sm-12  text-center">
          <a class="text-muted" href="../../../privacy/index.html">Privacy Policy</a> |
          <a class="text-muted" href="../../../terms/index.html">Terms of Service</a>
          <span class="copyright">&copy; Rithm Inc. 3338 17th Street Suite 100 San Francisco, CA 94110. All rights reserved. </span>
      </div>
    </div>
  </div>
</footer>

<!-- link that opens popup -->
<a style="display:none;" class="popup-with-form" href="#unlock-form">Open form</a>

<!-- form itself -->
<div class="thank_you"></div>
<div class="container">
  <form id="unlock-form" class="card mfp-hide white-popup-block" >
<input type="hidden" name="authenticity_token" id="authenticity_token" value="Letb3QIu49IfoHgarGo3FIj/OoeAOgTKHRD9UY6VFlLTRbvOXz/dshrFs0p3C7r2rPmguaIBYWzbY9LIdG+Y9w==" />  <div id="modal-first-part" class="row">
    <h1 class="text-center">Get 200+ hours of free content, tutorials, and screencasts</h1>
      <div class="col-sm-offset-2 col-sm-8">
        <hr class="modal--bar">
          <h5 class="text-center">Share your email, and we'll give you a confirmation code to unlock all of our materials. No spam, we promise.</h5>
          <div class="errors text-center"></div>
          <div class="row">
            <div class="col-lg-6">
              <div class="form-group">
                <input autofocus="autofocus" required="required" class="form-control" placeholder="First Name" type="text" name="first" id="first">
                <p class="help-block text-danger"></p>
              </div>
            </div>
              <div class="col-lg-6">
                <div class="form-group">
                  <input required="required" class="form-control" placeholder="Last Name" type="last" name="last" id="last">
                  <p class="help-block text-danger"></p>
                </div>
              </div>
            </div>
          <div class="row">
            <div class="col-lg-12">
              <div class="form-group">
                <input class="form-control" placeholder="Email Address" required="required" type="email" name="email" id="email">
                <p class="help-block text-danger"></p>
              </div>
            </div>
          </div>
          <button type="submit" class="next-button btn btn-xl">Next</button>
    </div>
  </div>
      <div id="modal-second-part" style="display:none;">
        <h1 class="text-center">Tell us more about yourself</h1>
          <div class="col-sm-offset-2 col-sm-8">
            <hr class="modal--bar">
            <h5 class="text-center">Please answer these two questions to help us build the perfect Rithm experience for you.</h5>
            <div class="errors text-center"></div>
        <div class="row">
          <div class="col-lg-12">
            <div class="form-group">
              How would you define your skill as a developer?
              <label for="Beginner"><input type="radio" class="radio" name="skill" id="Beginner" value='Beginner' required checked/> Beginner</label>
              <label for="Intermediate"><input type="radio" class="radio" name="skill" id="Intermediate" value='Intermediate'/>Intermediate </label>
              <label for="Advanced"><input type="radio" class="radio" name="skill" id="Advanced" value='Advanced'>Advanced </label>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-lg-12">
            <div class="form-group">
              Would you like to learn more about Rithm School's in-person courses and how to apply?
              <label for="yes"><input type="radio" class="radio" name="learn" id="yes" value="Yes" required checked/> Yes</label>
              <label for="no"><input type="radio" class="radio" name="learn" id="no" value="No" > No</label>
              <p class="help-block text-danger"></p>
            </div>
          </div>
        </div>
        <button type="submit" class="btn btn-xl">Get Content</button>
    </div>
  </div>
      <div id="modal-third-part" style="display:none;">
        <h1 class="text-center"></h1>
          <div class="col-sm-offset-2 col-sm-8">
            <hr class="modal--bar">
            <h5 class="text-center"></h5>
          </div>
      </div>
  </form>
  </div>




<!-- Go to www.addthis.com/dashboard to customize your tools --> <script type="text/javascript" src="https://s7.addthis.com/js/300/addthis_widget.js#pubid=ra-589bc2762de6c342"></script>

<script>/* <![CDATA[ */(function(d,s,a,i,j,r,l,m,t){try{l=d.getElementsByTagName('a');t=d.createElement('textarea');for(i=0;l.length-i;i++){try{a=l[i].href;s=a.indexOf('/cdn-cgi/l/email-protection');m=a.length;if(a&&s>-1&&m>28){j=28+s;s='';if(j<m){r='0x'+a.substr(j,2)|0;for(j+=2;j<m&&a.charAt(j)!='X';j+=2)s+='%'+('0'+('0x'+a.substr(j,2)^r).toString(16)).slice(-2);j++;s=decodeURIComponent(s)+a.substr(j,m-j)}t.innerHTML=s.replace(/</g,'&lt;').replace(/\>/g,'&gt;');l[i].href='mailto:'+t.value}}catch(e){}}}catch(e){}})(document);/* ]]> */</script></body>
</html>

<!-- Localized -->